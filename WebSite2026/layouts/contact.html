{{ define "main" }}
  {{ partial "page-header" . }}

  <section class="section-sm">
    <div class="container">
      <div class="row justify-center">
        <div class="md:col-10 lg:col-8 text-center">

          <!-- Main CTA Buttons -->
          <div class="contact-options mb-12">
            <h2 class="mb-8 text-h3-sm md:text-h3 text-text-dark dark:text-darkmode-text-dark">
              {{ i18n "contact_choose_option" | default "איך נוכל לעזור לכם?" }}
            </h2>

            <div class="flex flex-col sm:flex-row gap-6 justify-center items-center">
              <!-- WhatsApp Button -->
              <a
                href="https://wa.me/972528232535?text={{ i18n "whatsapp_message" | default "שלום, אשמח לקבל מידע על שירותי NG Workshop" | urlquery }}"
                target="_blank"
                rel="noopener noreferrer"
                class="contact-cta-btn whatsapp-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" class="ml-3 rtl:ml-0 rtl:mr-3">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                </svg>
                {{ i18n "contact_whatsapp" | default "שיחה בוואטסאפ" }}
              </a>

              <!-- Book Meeting Button -->
              <button
                type="button"
                onclick="document.getElementById('booking-form').classList.toggle('hidden')"
                class="contact-cta-btn booking-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-3 rtl:ml-0 rtl:mr-3">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                {{ i18n "contact_book_meeting" | default "קביעת פגישה" }}
              </button>
            </div>
          </div>

          <!-- Booking Form (Hidden by default) -->
          <div id="booking-form" class="hidden booking-form-container">
            <div class="bg-light dark:bg-darkmode-light rounded-lg p-8 max-w-md mx-auto">
              <h3 class="text-h4-sm md:text-h4 mb-6 text-text-dark dark:text-darkmode-text-dark">
                {{ i18n "contact_form_title" | default "השאירו פרטים ונתאם פגישה" }}
              </h3>

              <form id="contact-booking-form" class="text-right rtl:text-right ltr:text-left">
                <div class="mb-5">
                  <label for="name" class="form-label">
                    {{ i18n "form_name" | default "שם מלא" }} <span class="text-red-500">*</span>
                  </label>
                  <input
                    id="name"
                    name="name"
                    class="form-input"
                    placeholder="{{ i18n "form_name_placeholder" | default "הכניסו את שמכם" }}"
                    type="text"
                    required />
                </div>

                <div class="mb-5">
                  <label for="email" class="form-label">
                    {{ i18n "form_email" | default "אימייל" }} <span class="text-red-500">*</span>
                  </label>
                  <input
                    id="email"
                    name="email"
                    class="form-input"
                    placeholder="your@email.com"
                    type="email"
                    required />
                </div>

                <div class="mb-6">
                  <label for="phone" class="form-label">
                    {{ i18n "form_phone" | default "טלפון" }} <span class="text-red-500">*</span>
                  </label>
                  <input
                    id="phone"
                    name="phone"
                    class="form-input"
                    placeholder="050-000-0000"
                    type="tel"
                    required />
                </div>

                <!-- Consent Checkbox -->
                <div class="mb-6">
                  <label class="consent-label flex items-start gap-3 cursor-pointer">
                    <input
                      type="checkbox"
                      id="consent"
                      name="consent"
                      class="consent-checkbox mt-1"
                      required />
                    <span class="text-sm text-text dark:text-darkmode-text">
                      {{ i18n "form_consent" | default "אני מאשר/ת קבלת מיילים ושיחות טלפון מ-NG Workshop בנוגע לשירותים ועדכונים. ניתן לבטל את ההסכמה בכל עת." }}
                      <span class="text-red-500">*</span>
                    </span>
                  </label>
                </div>

                <button type="submit" class="btn btn-primary w-full" id="submit-btn">
                  <span id="btn-text">{{ i18n "form_submit" | default "המשך לקביעת פגישה" }}</span>
                  <span id="btn-loading" class="hidden">
                    <svg class="animate-spin h-5 w-5 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    {{ i18n "form_sending" | default "שולח..." }}
                  </span>
                </button>

                <p id="form-error" class="hidden text-red-500 text-sm mt-4"></p>
              </form>
            </div>
          </div>

          <!-- Contact Info -->
          <div class="contact-info mt-16 pt-12 border-t border-border dark:border-darkmode-border">
            <div class="grid md:grid-cols-3 gap-8 text-center">
              <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mx-auto mb-4 text-primary dark:text-darkmode-primary">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                  <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
                <h4 class="font-semibold mb-2 text-text-dark dark:text-darkmode-text-dark">{{ i18n "contact_email_label" | default "דואר אלקטרוני" }}</h4>
                <a href="mailto:workshop@ngworkshop.co.il" class="text-text dark:text-darkmode-text hover:text-primary dark:hover:text-darkmode-primary">
                  workshop@ngworkshop.co.il
                </a>
              </div>

              <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mx-auto mb-4 text-primary dark:text-darkmode-primary">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                <h4 class="font-semibold mb-2 text-text-dark dark:text-darkmode-text-dark">{{ i18n "contact_phone_label" | default "טלפון" }}</h4>
                <a href="tel:048232535" class="text-text dark:text-darkmode-text hover:text-primary dark:hover:text-darkmode-primary">
                  04-823-2535
                </a>
              </div>

              <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mx-auto mb-4 text-primary dark:text-darkmode-primary">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <h4 class="font-semibold mb-2 text-text-dark dark:text-darkmode-text-dark">{{ i18n "contact_address_label" | default "כתובת" }}</h4>
                <p class="text-text dark:text-darkmode-text">
                  {{ i18n "contact_address" | default "קיבוץ רמת השופט, ישראל" }}
                </p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <style>
    .contact-cta-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 1rem 2rem;
      font-size: 1.125rem;
      font-weight: 600;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      min-width: 220px;
    }

    .whatsapp-btn {
      background-color: #25d366;
      color: white;
    }

    .whatsapp-btn:hover {
      background-color: #20ba5a;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
    }

    .booking-btn {
      background-color: var(--color-primary, #8BC23C);
      color: white;
    }

    .booking-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 194, 60, 0.4);
    }

    .booking-form-container {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--color-text-dark);
    }

    .dark .form-label {
      color: var(--color-darkmode-text-dark);
    }

    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--color-border);
      border-radius: 0.375rem;
      background-color: white;
      transition: border-color 0.2s;
    }

    .dark .form-input {
      background-color: var(--color-darkmode-body);
      border-color: var(--color-darkmode-border);
      color: var(--color-darkmode-text);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(139, 194, 60, 0.1);
    }

    .consent-checkbox {
      width: 18px;
      height: 18px;
      accent-color: var(--color-primary);
      cursor: pointer;
      flex-shrink: 0;
    }

    .consent-label {
      text-align: right;
    }

    [dir="ltr"] .consent-label {
      text-align: left;
    }
  </style>

  <script>
    document.getElementById('contact-booking-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = e.target;
      const submitBtn = document.getElementById('submit-btn');
      const btnText = document.getElementById('btn-text');
      const btnLoading = document.getElementById('btn-loading');
      const errorEl = document.getElementById('form-error');

      // Get form data
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const phone = form.phone.value.trim();
      const consent = form.consent.checked;

      // Basic validation
      if (!name || !email || !phone) {
        errorEl.textContent = '{{ i18n "form_error_required" | default "נא למלא את כל השדות" }}';
        errorEl.classList.remove('hidden');
        return;
      }

      if (!consent) {
        errorEl.textContent = '{{ i18n "form_error_consent" | default "נא לאשר את הסכמתך לקבלת מיילים ושיחות" }}';
        errorEl.classList.remove('hidden');
        return;
      }

      // Show loading state
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');
      submitBtn.disabled = true;
      errorEl.classList.add('hidden');

      try {
        // Send form data via FormSubmit (free email service, no registration required)
        const response = await fetch('https://formsubmit.co/ajax/guy@ngworkshop.co.il', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            email: email,
            phone: phone,
            consent: 'אישר/ה קבלת מיילים ושיחות',
            _subject: 'בקשת פגישה חדשה מהאתר - ' + name,
            _template: 'table'
          })
        });

        if (response.ok) {
          // Redirect to Calendly
          window.location.href = 'https://calendly.com/ngworkshop/30-minute-meeting?name=' + encodeURIComponent(name) + '&email=' + encodeURIComponent(email);
        } else {
          throw new Error('Form submission failed');
        }
      } catch (error) {
        console.error('Error:', error);
        errorEl.textContent = '{{ i18n "form_error_general" | default "אירעה שגיאה, נסו שוב או צרו קשר בוואטסאפ" }}';
        errorEl.classList.remove('hidden');
        btnText.classList.remove('hidden');
        btnLoading.classList.add('hidden');
        submitBtn.disabled = false;
      }
    });
  </script>
{{ end }}
